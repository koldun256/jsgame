<!DOCTYPE html>
<html>
    <head>

    </head>
    <body>
        <canvas id="canvas" style="border: 2px solid black"></canvas>
        <script src="/socket.io/socket.io.js"></script>
        <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
        <script>
            var socket = io();
            var blockHeight = 10;
            var blockWidth = 10;
            let ctx = document.getElementById("canvas").getContext("2d");
            let state = 0;
            ctx.fillStyle = "black";
            ctx.font = "20px serif";
            ctx.fillText("Нажмите на это что бы начать", 10, 50);
            function clear(){
                ctx.clearRect(0, 0, document.getElementById("canvas").width, document.getElementById("canvas").height);
            }
            function drawBlock(x,y){
                ctx.fillRect(x*blockWidth,y*blockHeight,blockWidth,blockHeight);
            }
            $(document).keydown(function(event){
                socket.emit("moved",{key:event.key});
            });
            function updateImage(players){
                clear();
                for(key in players){
                    drawBlock(...players[key].position);
                }
            }
            socket.on("setsize",function(msg){
                $("#canvas").height(msg.height*blockHeight);
                $("#canvas").width(msg.width*blockWidth);
                $("#canvas").click(function(){
                    if(state==0) socket.emit("started");
                });
            });
            socket.on("wait",function(){
                clear();
                ctx.fillText("Ждите", 10, 50);
                state = 1;
            });
            socket.on("start",function(){
                console.log("st");
                state = 2;
            });
            socket.on("update",function(msg){
                updateImage(msg.players);
            });
        </script>
    </body>
</html>